<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <title>Тестирование</title>
</head>
<body>
    <div class="title">Тестирование</div>
    <div id="panelCity" class="panel panel-param">
        <label>Количество запросов:</label><br>
        <input id="reqCount" type="text" />

        <button type="button" onclick="doTest();">
            Запустить тест
        </button>
    </div>

    <script style="display: none;">

        function doTest(mode, data) {
            const url = (mode == 'Ip' ? '/ip/location' : mode == 'City' ? '/city/locations' : 'error')
                + '?text=' + encodeURI(data);
            console.log(url);

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const json = await response.json();
                console.log('Успех:', JSON.stringify(json));

                if (json.Status == 3) {
                    showError(json.Msg);
                    alert(json.Msg);
                }
                else {
                    const info = getResultInfo(json);
                    document.getElementById('searchResult').innerHTML = info;
                    document.getElementById('searchResult').style.display = "block";
                }
            } catch (error) {
                console.error('Ошибка:', error);
                showError(error);
            }
        }
</script>
</body>
</html>
